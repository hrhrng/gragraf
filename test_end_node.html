<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>END 节点错误修复测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .container {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        .success {
            background-color: #4caf50;
            color: white;
        }
        .error {
            background-color: #f44336;
            color: white;
        }
        .info {
            background-color: #2196f3;
            color: white;
        }
        button {
            background-color: #6366f1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #5338e5;
        }
        .log {
            background-color: #333;
            padding: 15px;
            border-radius: 6px;
            min-height: 100px;
            font-family: monospace;
            overflow-y: auto;
            max-height: 300px;
            font-size: 12px;
        }
        .error-entry {
            color: #ff6b6b;
            margin-bottom: 5px;
        }
        .info-entry {
            color: #4ecdc4;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>🔧 END 节点 ResizeObserver 错误修复测试</h1>
    
    <div class="container">
        <h2>测试状态</h2>
        <div id="status" class="status info">准备开始测试...</div>
        
        <h3>测试说明</h3>
        <p>此页面专门测试 END 节点的 ResizeObserver 错误修复。如果修复成功，控制台中不应该出现 ResizeObserver 相关的错误。</p>
        
        <h3>测试步骤</h3>
        <ol>
            <li>打开浏览器开发者工具（F12）</li>
            <li>切换到 Console 标签页</li>
            <li>点击下面的"开始测试"按钮</li>
            <li>观察控制台和下方的错误日志</li>
            <li>如果没有 ResizeObserver 错误，修复成功！</li>
        </ol>
        
        <button onclick="startTest()">🧪 开始测试</button>
        <button onclick="clearLog()">🧹 清除日志</button>
        <button onclick="openApp()">🚀 打开 GraGraf 应用</button>
    </div>
    
    <div class="container">
        <h2>错误监控日志</h2>
        <div id="errorLog" class="log">
            <div style="color: #888;">等待测试开始...</div>
        </div>
    </div>
    
    <script>
        let errorCount = 0;
        let resizeObserverErrorCount = 0;
        const logElement = document.getElementById('errorLog');
        const statusElement = document.getElementById('status');
        
        // 监控所有控制台错误
        const originalConsoleError = console.error;
        console.error = function(...args) {
            const message = args.join(' ');
            
            if (message.includes('ResizeObserver')) {
                resizeObserverErrorCount++;
                addLogEntry(`❌ ResizeObserver 错误 (#${resizeObserverErrorCount}): ${message}`, 'error');
                updateStatus();
            } else {
                errorCount++;
                addLogEntry(`⚠️ 其他错误 (#${errorCount}): ${message}`, 'error');
            }
            
            // 仍然输出到原始控制台
            originalConsoleError.apply(console, args);
        };
        
        // 监控全局错误事件
        window.addEventListener('error', function(event) {
            if (event.message && event.message.includes('ResizeObserver')) {
                resizeObserverErrorCount++;
                addLogEntry(`❌ ResizeObserver 全局错误: ${event.message}`, 'error');
                updateStatus();
            } else {
                errorCount++;
                addLogEntry(`⚠️ 全局错误: ${event.message}`, 'error');
            }
        });
        
        function addLogEntry(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = type + '-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateStatus() {
            if (resizeObserverErrorCount > 0) {
                statusElement.className = 'status error';
                statusElement.textContent = `❌ 检测到 ${resizeObserverErrorCount} 个 ResizeObserver 错误 - 修复无效`;
            } else if (errorCount > 0) {
                statusElement.className = 'status info';
                statusElement.textContent = `ℹ️ 检测到 ${errorCount} 个其他错误，但没有 ResizeObserver 错误`;
            } else {
                statusElement.className = 'status success';
                statusElement.textContent = '✅ 没有检测到任何错误 - 修复成功！';
            }
        }
        
        function startTest() {
            addLogEntry('🧪 开始 ResizeObserver 错误测试...', 'info');
            addLogEntry('📝 这个测试会创建和销毁一些元素来触发可能的 ResizeObserver 错误', 'info');
            
            // 创建测试元素
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const testDiv = document.createElement('div');
                    testDiv.style.width = '100px';
                    testDiv.style.height = '100px';
                    testDiv.style.backgroundColor = '#444';
                    testDiv.style.margin = '5px';
                    testDiv.style.transition = 'all 0.1s ease';
                    testDiv.style.position = 'absolute';
                    testDiv.style.top = '50px';
                    testDiv.style.left = `${100 + i * 120}px`;
                    
                    document.body.appendChild(testDiv);
                    
                    // 快速改变大小
                    setTimeout(() => {
                        testDiv.style.width = '200px';
                        testDiv.style.height = '50px';
                    }, 50);
                    
                    setTimeout(() => {
                        testDiv.style.width = '50px';
                        testDiv.style.height = '200px';
                    }, 100);
                    
                    setTimeout(() => {
                        testDiv.style.width = '150px';
                        testDiv.style.height = '150px';
                    }, 150);
                    
                    // 移除元素
                    setTimeout(() => {
                        document.body.removeChild(testDiv);
                    }, 300);
                }, i * 100);
            }
            
            // 测试完成
            setTimeout(() => {
                addLogEntry('✅ ResizeObserver 测试完成', 'info');
                updateStatus();
                
                if (resizeObserverErrorCount === 0) {
                    addLogEntry('🎉 恭喜！没有检测到 ResizeObserver 错误，修复成功！', 'info');
                } else {
                    addLogEntry('💔 很遗憾，仍然检测到 ResizeObserver 错误，需要进一步修复', 'error');
                }
            }, 2000);
        }
        
        function clearLog() {
            logElement.innerHTML = '<div style="color: #888;">日志已清除...</div>';
            errorCount = 0;
            resizeObserverErrorCount = 0;
            statusElement.className = 'status info';
            statusElement.textContent = '准备开始新的测试...';
        }
        
        function openApp() {
            addLogEntry('🚀 正在打开 GraGraf 应用...', 'info');
            window.open('http://localhost:3000', '_blank');
        }
        
        // 初始状态更新
        updateStatus();
    </script>
</body>
</html> 